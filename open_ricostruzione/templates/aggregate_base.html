{% extends 'base.html' %}

{% block content %}

    <div class="row">
        <div class="col-md-12">
            {% block page-title %}{% endblock %}
        </div>
    </div>
    {% block home-intro %}{% endblock %}

    <section class="cifre top-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-md-offset-1 text-center">
                    <h1>
                        LA RICOSTRUZIONE IN CIFRE
                    </h1>
                    <p>Ultimo aggiornamento: {{ ultimo_aggiornamento|date }} - {{ n_comuni_monitorati }} comuni monitorati su {{ n_comuni_cratere }}</p>
                </div>
            </div>
        </div>
    </section>

    {% block status %}
        {% include 'aggregates/status.html' %}

{#        <div class="row basic_spacer">#}
{#            {% include 'aggregates/data_block.html' with title='interventi a programma' data_dict=status.programmazione  %}#}
{#            {% include 'aggregates/data_block.html' with title='interventi a piano' data_dict=status.pianificazione perc_label='a piano' status_filters="piano" %}#}
{#            {% include 'aggregates/data_block.html' with title='interventi in attuazione' data_dict=status.attuazione perc_label='in attuazione' status_filters="attuazione" %}#}
{#            {% include 'aggregates/varianti_block.html' %}#}
{#        </div>#}
{##}
        {#    execution status bar / status blocks #}
{#        {% include "aggregates/execution_status.html" %}#}
    {% endblock %}

    {# fetch progetti #}

    {% if interventi_top_importo %}
        <section class="latest">
            <div class="container">

                <div class="row text-center">
                    <h1>
                        GLI INTERVENTI CON MAGGIORI IMPORTI
                    </h1>
                </div>

                <div class="row lists">
                    <div class="col-md-6 list-item">
                        {% include 'aggregates/intervento_block.html' with intprog=interventi_top_importo.0 %}
                    </div>
                    <div class="col-md-6 list-item">
                        {% include 'aggregates/intervento_block.html' with intprog=interventi_top_importo.2 %}
                    </div>
                    <div class="col-md-6 list-item">
                        {% include 'aggregates/intervento_block.html' with intprog=interventi_top_importo.1 %}
                    </div>
                    <div class="col-md-6 list-item">
                        {% include 'aggregates/intervento_block.html' with intprog=interventi_top_importo.3 %}
                    </div>
                    <a href="#" class="pull-right alls">VEDI TUTTI</a>
                </div>
            </div>
        </section>
    {% endif %}

    {% block thematic-map %}
        <section class="dove top-bottom">
            <div class="row basic_spacer">
                <div class="col-md-12">
                    <h1>DOVE SI INTERVIENE</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {% if impresa %}
                        <div id="mappa_attuazione" class="map"></div>
                    {% else %}
                        <div role="tabpanel">

                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active">
                                    <a href="#tab_danno" aria-controls="tab_danno" role="tab" data-toggle="tab" id="handle_danno" class="btn btn-show active">Mappa Danno</a>

                                </li>
                                <li role="presentation">
                                    <a href="#tab_attuazione" aria-controls="tab_attuazione" role="tab" data-toggle="tab" id="handle_attuazione" class="btn btn-show">Mappa Attuazione</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane fade in active" id="tab_danno"><div id="mappa_danno" class="map"></div></div>
                                <div role="tabpanel" class="tab-pane fade" id="tab_attuazione"><div id="mappa_attuazione" class="map"></div></div>
                            </div>

                        </div>

                    {% endif %}

                </div>

            </div>

        </section>

        {% include 'modules/thematic_maps.html'  %}

{#    <section class="dove top-bottom">#}
{#        <div class="container">#}
{#            <div class="row">#}
{#                <div class="col-md-12 text-center">#}
{#                    <div class="show">#}
{#                        <a href="" class="btn btn-show active">MOSTRA PROGRAMMAZIONE</a>#}
{#                        <a href="" class="btn btn-show">MOSTRA STEP ATTUAZIONE</a>#}
{#                    </div>#}
{#                    <h1>#}
{#                        DOVE SI INTERVIENE#}
{#                    </h1>#}
{#                    <div id="map"></div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </section>#}

    {% endblock %}

    {# aggregazione tipo immobile    #}
    {% block tipo-immobile %}
        {% if tipo_immobile_aggregates %}
            <div class="row">
                <div class="col-md-12">
                    <h1>Per cosa si interviene?</h1>
                </div>
            </div>
            <div class="row" style="font-size: 11px;">
                <div class="col-md-12">
                    <table class="debug_table">
                        <tr>
                            <th rowspan="2"> tipo immobile</th>
                            <th colspan="2"> programma</th>
                            <th colspan="2"> piano</th>
                            <th colspan="2"> attuazione</th>
                        </tr>
                        <tr>
                            <th>numero</th>
                            <th>ammontare</th>
                            <th>numero</th>
                            <th>ammontare</th>
                            <th>numero</th>
                            <th>ammontare</th>
                        </tr>

                            {% for tipo_immobile in tipo_immobile_aggregates %}
                                <tr>
                                    <td><strong>{{ tipo_immobile.name }}</strong></td>
                                    <td>{{ tipo_immobile.programmazione.count }}</td><td>{{ tipo_immobile.programmazione.sum }} euro </td>
                                    <td>{{ tipo_immobile.pianificazione.count }}</td><td>{{ tipo_immobile.pianificazione.sum }} euro</td>
                                    <td>{{ tipo_immobile.attuazione.count }}</td><td>{{ tipo_immobile.attuazione.sum }} euro</td>
                                </tr>
                            {% endfor %}
                    </table>
                </div>
            </div>
            {% include 'modules/tipo_immobile_bars.html' %}
        {% endif %}

    {% endblock %}

    {# aggregazione tipo sogg. att #}
    {% block soggetto-attuatore %}

        {% include 'aggregates/sogg_att_block.html' with pie_title="Aggregazione per tipo sogg.attuatore - ammontare" %}

    {% endblock %}


    {% block imprese %}
        {# fetch imprese #}
        {% if imprese_top %}
            <div class="row basic_spacer" style="margin-bottom: 5px;">
                <div class="col-md-12">
                    <h1>LE IMPRESE CON PIÃ™ INTERVENTI</h1>
                </div>

            </div>
            <div class="row basic_spacer">
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.0 %}
                </div>
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.3 %}
                </div>
            </div>
            <div class="row basic_spacer">
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.1 %}
                </div>
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.4 %}
                </div>
            </div>
            <div class="row basic_spacer">
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.2 %}
                </div>
                <div class="col-md-6">
                    {% include 'aggregates/impresa_block.html' with impresa=imprese_top.5 %}
                </div>
            </div>
        {% endif %}
    {% endblock %}

    {# aggregazione tipologia cedente #}
    {% block donazioni %}
        <hr>
        {% if donazioni_totale.sum > 0 %}
            {% include 'aggregates/donazioni_block.html' %}
        {% else %}
            Non sono state ricevute donazioni
        {% endif %}

    {% endblock %}



{% endblock %}