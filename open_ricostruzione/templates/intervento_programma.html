{% extends 'base.html' %}
{% load italianize %}

{% block head-title %}
    {{ intervento_programma.denominazione }}
{% endblock %}


{% block content %}

    <section class="container intro">
     	<div class="row">
        	<div class="col-md-10 col-md-offset-1 text-center intervento-denominazione">
            	{{ intervento_programma.denominazione }}
            </div>
        </div>
    </section>

    <section class="pianificato-schedaA">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    {% if not vari_territori %}
                        {% include 'modules/simple_map.html' %}
                    {% endif %}
                    <div class="testo-mappa">
                        {% if intervento_programma.vari_territori %}
                            Intervento Sovracomunale
                        {% else %}
                            {{ intervento_programma.territorio.nome_con_provincia }}
                        {% endif %}
                    </div>
				</div>
                <div class="col-md-8">
                    {% if intervento_programma.stato == 'programma'  %}
                            <div class="programmati">
                                <span>
                                    INTERVENTO A PROGRAMMA
                                </span>
                            </div>
                    {% elif intervento_programma.stato == 'piano'  %}
                            <div class="pianificati">
                                <span>
                                    INTERVENTO A PIANO
                                </span>
                            </div>
                    {% elif intervento_programma.stato == 'attuazione' %}
                            <div class="attuati">
                                <span>
                                    INTERVENTO IN ATTUAZIONE
                                </span>
                            </div>
                    {% endif %}

                    <div class="row">
                        {% if intervento_programma.stato == 'piano' or intervento_programma.stato == 'attuazione' %}
                            <div class="col-md-12 opere-pubbliche">
                                {{ intervento_piano.piano.denominazione }}
                            </div>
                        {% endif %}

                        <div class="col-md-3">
                            <div class="what">
                                <span class="sector viabilita"> </span>
                                {{ intervento_programma.tipo_immobile }}
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="nome-proprietario">
                                        <div class="etichetta">Proprietario</div>
                                        {{ intervento_programma.propr_immobile.denominazione }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="nome-attuatore">
                                        <div class="etichetta">Soggetto Attuatore</div>
                                        <a href="{% url 'sogg-attuatore' intervento_programma.soggetto_attuatore.slug  %}">
                                            {{ intervento_programma.soggetto_attuatore.denominazione }}
                                        </a>
                                    </div>
                                </div>
                                {% if imprese %}
                                    <div class="col-md-12">
                                        <div class="nome-lavoro">
                                            <div class="etichetta">Imprese</div>
                                            {% for impresa in imprese %}
                                                <a href="{% url 'impresa' impresa.slug %}">{{ impresa.ragione_sociale }}</a><br/>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {# importi / cofinanziamenti / liquidazioni   #}
    <section class="importi-intervento1">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h1>Gli importi dell'intervento</h1>
                </div>
            </div>
        </div>
    </section>

    {% if intervento_programma.stato == 'programma' or  intervento_programma.stato == 'piano' %}
        {% include 'modules/importi_programmazione.html' %}
    {% elif intervento_programma.stato == 'attuazione' %}
        {% include 'modules/importi_attuazione.html' %}
    {% endif %}

    {# barra stato avanzamento   #}
    {% if intervento_programma.stato == 'attuazione' %}
        <section class="avanzamento">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <h1>Stato di avanzamento</h1>
                    </div>

                    <div class="row avanzamento-progetto">

                        <div class="col-sm-4 box state1">
                            <div class="header">
                                Progettazione
                            </div>

                            {% if progetti|length > 0 %}
                                <ul class="lista">
                                    {% for p in progetti %}
                                        <li class="row {% if p.data_fine %}done{% endif %}">
                                            <div class="col-xs-7"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> {{ p.get_tipologia_display }}</div>
                                            <div class="col-xs-5 text-right">
                                                {% if p.data_fine %}
                                                    {{ p.data_fine }}
                                                {% elif p.data_inizio %}
                                                    {{ p.data_inizio }}
                                                {% elif p.data_deposito %}
                                                    {{ p.data_deposito }}
                                                {% endif %}
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>

                        {% if intervento_programma.stato_attuazione == 'in_corso' or intervento_programma.stato_attuazione == 'concluso' %}
                            <div class="col-sm-4 box state2">
                                <div class="header">
                                        Lavori in corso
                                </div>
                                {% if eventi_in_corso|length > 0  %}
                                    <ul class="lista">
                                        {% for eic in eventi_in_corso %}
                                            <li class="row done">
                                                <div class="col-xs-7"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> {{ eic.get_tipologia_display }}</div>
                                                <div class="col-xs-5 text-right">{{ eic.data }}</div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if intervento_programma.stato_attuazione == 'concluso' %}
                            <div class="col-sm-4 box state3">
                                <div class="header">

                                    <small>Data fine effettiva</small> 16 Settembre 2013

                                </div>

                                {% if eventi_fine|length > 0  %}
                                    <ul class="lista">
                                        {% for ef in eventi_fine %}
                                            <li class="row done">
                                                <div class="col-xs-7"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> {{ ef.get_tipologia_display }}</div>
                                                <div class="col-xs-5 text-right">{{ ef.data }}</div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        {% endif %}

                    </div>
                </div>
            </div>
        </section>

    {% endif %}

    {#    varianti #}
    {% if varianti %}
        <section class="varianti">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3 text-center">
                        <h1>Varianti</h1>

                        <table>
                            {% for v in varianti %}
                                <tr>
                                    <th class="etichetta">{{ v.get_tipologia_display|title }}</th>
                                    <th class="carico">{{ v.get_stato_display }}</th>
                                    <th class="data">{{ v.data_deposito }}</th>
                                </tr>
                            {% endfor %}

                        </table>

                    </div>
                </div>
            </div>
        </section>
    {% endif %}


{% endblock %}