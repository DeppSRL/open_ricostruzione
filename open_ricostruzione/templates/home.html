{% load humanize %}
<!DOCTYPE html >
<html lang="en" >
<head>
    <meta charset="utf-8">
    <title>Open Ricostruzione - {% block title %} {% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="" >

    <!-- Le styles -->
    <link href="{{ STATIC_URL }}css/smoothness/jquery-ui-1.9.1.custom.css" rel="stylesheet">

    {% if DEBUG %}

        <link href="{{ STATIC_URL }}less/styles.less" rel="stylesheet/less">
        <link href="{{ STATIC_URL }}less/styles-responsive.less" rel="stylesheet/less">
        <script type="text/javascript" src="{{ STATIC_URL }}js/less-1.3.1.min.js"></script>

    {% else %}

        <link href="{{ STATIC_URL }}css/bootstrap-responsive.css" rel="stylesheet">
        <link href="{{ STATIC_URL }}css/bootstrap.css" rel="stylesheet">

    {% endif %}
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
    <!--[if lte IE 8]>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.ie.css" />
    <![endif]-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="{{ STATIC_URL }}ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{{ STATIC_URL }}ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{{ STATIC_URL }}ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{{ STATIC_URL }}ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="{{ STATIC_URL }}ico/apple-touch-icon-57-precomposed.png">
</head>

<body>
<div class="wrapper">
<!-- HEADER -->
<div class="container header">
    <div class="row ">
        <div  id="logo_header" >
            <div class="span7" id="logo_top">
                <a href="/">
                    <img src="../static/img/logo_white.png">
                </a>
            </div>
            {% if iban %}
                <div class="span4" id="appello">
                    {% block support %}
                        Aiutaci a ricostruire!<br/>
                        <div class="iban">
                            <div class="title">Codice Iban</div>
                            <div class="number">&nbsp;</div>
                        </div>
                        <div class="iban">
                            <div class="title">Codice Bic Swift (bonifici dall'estero)</div>
                            <div class="number">&nbsp;</div>
                        </div>
                    {% endblock %}
                </div><!--/span-->
            {% endif %}
        </div>
    </div>
</div>

<!-- /HEADER-->
<!-- NAVBAR-->
<div id="top_navbar">
    <div class="container">
        <div class="row" id="">
            <div class="span6" id="navbar-span">
                <nav class="navbar navbar-custom">
                    <div class="navbar-inner-custom ">
                        <ul class="nav">
                            <li class="dropdown ">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Progetti <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    {% for t in tipologie_progetti %}
                                        <li class="submenu">
                                            <a href="../tipologie-progetto/{{ t.slug }}">{{ t.denominazione }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li class="">
                                <a href="../donazioni/" >Donazioni </a>
                            </li>
                            <li class="dropdown ">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Comuni <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    {% regroup territori by get_provincia as group %}
                                    {% for g in group|dictsort:"grouper.denominazione" %}
                                        <li class="dropdown-submenu">
                                            <a>
                                                {{ g.grouper.denominazione|title }}
                                            </a>
                                            <ul class="dropdown-menu">
                                                {% for item in g.list|dictsort:"denominazione"%}
                                                    <li>
                                                        <a href="../comune/{{ item.slug }}">
                                                            {{ item.denominazione }}
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>

                        </ul>

                    </div>
                </nav>
            </div> <!--/navbar-span -->
            <div class="offset1 span5">
                <form method="get" action="/progetti/" class="navbar-search form-search pull-left">
                    <section  class="ui-widget">
                        <input type="text"
                               class="search-query "
                               id="progetto-search"
                               placeholder="Cerca tra i progetti" />
                    </section>
                </form>

            </div>
        </div>
    </div>
</div>
<!-- /NAVBAR-->
<div id="top_home">
    <div class="container content">
        <div class="row">
            <div class="span5">
                <div id="main-content">
                    Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto
                    Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto Breve descrizione del progetto

                </div>
            </div>


            <div class="span5 offset2 boxes" id="boxes-home">
                <div class="span2" >
                    {%  if stima_danno %}
                        <div class="title">Stima del danno </div>
                        <div class="box" id="danno">
                            <div class="number"> {{ stima_danno|onlynumber }}</div>
                            <div class="grandezza">{{ stima_danno|onlyword }} {% if stima_danno > 1000000 %}di{% endif %} Euro</div>
                        </div>
                        <div class="subtitle">
                            {% if n_progetti %}
                                Per {{ n_progetti }} progett{% if n_progetti < 2 %}o{% else %}i{% endif %} di ricostruzione
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                <div class="span2" >
                    {% if tot_donazioni %}
                        <div class="title">Donazioni ricevute</div>
                        <div class="box" id="donazioni">
                            <div class="number">{{ tot_donazioni|onlynumber}} </div>
                            <div class="grandezza">{{ tot_donazioni|onlyword }} {% if tot_donazioni > 1000000 %}di{% endif %} Euro</div>
                        </div>
                        <div class="subtitle">Da {{ n_donazioni }} donazion{% if n_donazioni < 2 %}e{% else %}i{% endif %}</div>
                    {% endif %}

                </div>
                </div>


            <div class="span5 offset2" id="aggiornamento" >
                Ultimo aggiornamento: 28 Novembre 2012 - {{ n_comuni }} Comuni monitorati
            </div>
        </div>
    </div><!--/.container-->
</div>

<div class="container" id="home-map">
    <div class="row">
        <div class="span12">
            <img src="../static/img/home_map.jpg" />
        </div>
    </div>
</div>

<div class="container content">
    <!-- PIE CHARTS -->
    <div class="row" id="data-content">
        <div class="span6">
            {% if progetti_categorie %}

                <div class="titolo danno"> Progetti per la ricostruzione</div>
                <div class="subtitle">Ripartizione dei danni per categorie</div>
                <div  id="proj_pie"></div>
                <div class="project_list">
                    {% for p in progetti_categorie %}
                        <div class="project_row ">
                            <div class="box">
                                <div class="n_progetti">{{ p.c }} <a href="../tipologie-progetto/">{{ p.tipologia__denominazione }}</a></div>
                                <div class="importo">{{ p.sum|floatformat}} euro</div>
                            </div>
                            <div class="spacer"></div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div><!-- /span -->
        <div class="span6">
            {% if donazioni_categorie %}
                <div class="span6 titolo donazioni"> Donazioni ricevute</div>
                <div class="span6 subtitle">Ripartizione delle donazioni per soggetti</div>
                <div id="don_pie"></div>
                <div class="project_list">
                    {% for p in donazioni_categorie %}
                        <div class="project_row ">
                            <div class="box">
                                <div class="n_progetti">{{ p.c }} da {{ p.tipologia__denominazione }}</div>
                                <div class="importo">{{ p.sum|floatformat}} euro</div>
                            </div>
                            <div class="spacer"></div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div><!-- /span -->
    </div> <!-- /row -->

    <div class="row">
        <div class="span12">
            <div id="comuni_evidenza" class="evidenza">
                <div class="titolo" > Comuni oggi in evidenza</div>
                <div class="subtitle">Aggregato dei danni per Comune</div>
                <div class="row-fluid" style="border-bottom:1px solid #CCCCCC;">
                    <div class="span3" style="font-weight: bold;">Comune</div>
                    <div class="span3" style="font-weight: bold;">Danno</div>
                    <div class="span3" style="font-weight: bold;">Donazione</div>
                </div>
                {% for c in comuni_evidenza %}
                    <div class="row-fluid" style="border-bottom:1px solid #CCCCCC;">
                        <div class="span3" style="color: #4467af;">
                            <a href="../comune/{{ c.slug }}">{{ c.denominazione }} ({{ c.get_provincia.sigla_provincia }})</a>
                        </div>
                        <div class="span3" style="">{{ c.p_sum|floatformat }} euro</div>
                        <div class="span3" style="">{{ c.d_sum }} euro</div>
                    </div>

                {% endfor %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span12">
            <div id="progetti_evidenza" class="evidenza">
                <div class="titolo" > Progetti oggi in evidenza</div>
                <div class="subtitle">Tre progetti in rilievo</div>
                <div class="row-fluid" style="border-bottom:1px solid #CCCCCC;">
                    <div class="span3" style="font-weight: bold;">Comune</div>
                    <div class="span3" style="font-weight: bold;">Tipologia</div>
                    <div class="span3" style="font-weight: bold;">Danno</div>
                </div>
                {% for p in progetti_evidenza %}
                    <div class="row-fluid" style="border-bottom:1px solid #CCCCCC;">
                        <div class="span3" style="color: #4467af;">
                            <a href="../comune/{{ c.slug }}">{{ p.territorio.denominazione }} ({{ p.territorio.get_provincia.sigla_provincia }})</a>
                        </div>
                        <div class="span3" style=""><a href="../tipologie-progetto/">{{ p.tipologia.denominazione }}</a></div>
                        <div class="span3" style="">{{ p.riepilogo_importi }} euro</div>
                    </div>

                {% endfor %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span6">
            <div id="don_last" class="evidenza">
                <div class="titolo"> Ultime donazioni</div>
{#                    <div class="subtitle"></div>#}
                <div class="project_list">

                    <div class="project_row ">
                        <div class="box">
                            <div class="n_progetti">
                                Concerto Campovolo
                            </div>
                            <div class="importo">XXXXX euro</div>
                        </div>
                        <div class="spacer"></div>
                    </div>


                    <div class="project_row ">
                        <div class="box">
                            <div class="n_progetti">
                                Ricevute tramite SMS
                            </div>
                            <div class="importo">XXXXX euro</div>
                        </div>
                        <div class="spacer"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<!-- FOOTER -->
<footer>
    <div id="green-background">
        <div class="container">
            <div class="row footer">
                <div class="span4" >
                    <div class="title">Questo sito</div>
                    <div class="text">
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,
                    </div>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="../il-progetto">
                                    Il Progetto
                                </a>
                            </li>
                            <li>
                                <a href="../chi-siamo">
                                    Chi siamo
                                </a>
                            </li>
                            <li>
                                <a href="../faq">
                                    FAQ
                                </a>
                            </li>
                            <li>
                                <a href="../contatti">
                                    Contatti
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="span4 offset2" >
                    <div class="title">Open Data</div>
                    <div class="text">
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,Lorem ipsum,
                        Lorem ipsum,Lorem ipsum,Lorem ipsum,
                    </div>
                    <div class="links">
                        <ul>
                            <li>
                                <a href="../download">
                                    Scarica gli open data
                                </a>
                            </li>
                            <li>
                                <a href="../licenza">
                                    Licenza di utilizzo
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div> <!--/row-->
        </div>
    </div>
    <div id="gray-background">
        <div id="partners" style="text-align: center;">
            {#            <div class="span2 offset3">#}
            {#                <img src="../static/img/wikitalia.png">#}
            {#            </div>#}
            {#            <div class="span2">#}
            {#                <img src="../static/img/cisco.png">#}
            {#            </div>#}
            {#            <div class="span2">#}
            {#                <img src="../static/img/actionaid.png">#}
            {#            </div>#}
            <img src="../static/img/footer.png">
        </div>
    </div>
</footer>
<!-- /FOOTER -->
</div>
<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="{{ STATIC_URL }}js/jquery.js"></script>
<script src="{{ STATIC_URL }}js/bootstrap.min.js"></script>
<script src="{{ STATIC_URL }}js/highcharts.js"></script>
<script src="{{ STATIC_URL }}js/jquery-ui-1.9.1.custom.min.js" type="text/javascript" ></script>


<script type="text/javascript">

    $(document).ready(function() {
        $('#progetto-search').focus(function(){
            if ($(this)._cleared) return;
            $(this).val('');
            $(this)._cleared = true;
        });


        $( "#progetto-search" ).autocomplete({
            source: function( request, response ) {
                $.getJSON(
                        "{{ SITE_URL }}/progetti.json",
                        {'qterm': request.term },
                        function( data ) {
                            response( $.map( data, function( item ) {
                                return {
                                    label: item.fields.denominazione,
                                    value: item.fields.slug
                                }
                            }));
                        }
                );
            },
            minLength: 4,
            select: function( event, ui ) {
                window.location.href = "../progetto/"+ ui.item.value;
            },
            open: function() {
                $( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
            },
            close: function() {
                $( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
            }
        }).css('z-index', 10000);
    });

</script>

<script>

    var piechart1, piechart2;
    $(document).ready(function() {


        /*PIE CHART*/
        {% if progetti_categorie %}
            /*TIPOLOGIA PROGETTI */
            piechart1 = new Highcharts.Chart({
                chart: {
                    renderTo: 'proj_pie',
                    type: 'pie',
                    plotBackgroundColor: '#fff'

                },
                tooltip: {
                    formatter: function() {
                        return '<div class="tooltip-box"><b>'+ this.point.name +'</b>: '+ this.percentage.toFixed(2) +'<small>%</small></div>';
                    },
                    useHTML: true,
                    backgroundColor: '#F7F6F1',
                    borderWidth: 0,
                    shadow: false,
                    style: {
                        width: '150px',
                        'min-height': '20px'
                    }
                },
                title: {
                    text: ''
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',

                        dataLabels: {
                            enabled: false,
                            color: '#000000',
                            connectorColor: '#000000',
                            percentageDecimals: 2,
                            formatter: function() {
                                return '<b>'+ this.point.name +'</b>: '+ this.y +' Euro';
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Tipologia progetto',
                    title: 'Progetti per tipologia',
                    data: [
                        {% for p in progetti_categorie %}
                            ['{{ p.tipologia__denominazione }}',{{ p.sum|floatformat }}],
                        {% endfor %}
                    ]
                }]

            });
        {% endif %}
        {% if donazioni_categorie%}
            /*CATEGORIA DONAZIONI */

            piechart2 = new Highcharts.Chart({
                chart: {
                    renderTo: 'don_pie',
                    type: 'pie',
                    plotBackgroundColor: '#fff'

                },
                tooltip: {
                    formatter: function() {
                        return '<div class="tooltip-box"><b>'+ this.point.name +'</b>: '+ this.percentage.toFixed(2) +'<small>%</small></div>';
                    },
                    useHTML: true,
                    backgroundColor: '#F7F6F1',
                    borderWidth: 0,
                    shadow: false,
                    style: {
                        width: '150px',
                        'min-height': '20px'
                    }
                },
                title: {
                    text: ''
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false,
                            color: '#000000',
                            connectorColor: '#000000',
                            percentageDecimals: 2,
                            formatter: function() {
                                return '<b>'+ this.point.name +'</b>: '+ this.y +' Euro';
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Tipologia progetto',
                    title: 'Donazioni per tipologia',
                    data: [
                        {% for d in donazioni_categorie %}
                            ['{{ d.tipologia__denominazione }}',{{ d.sum }}],
                        {% endfor %}
                    ]
                }]
            });
        {% endif %}
    });
</script>

</body>
</html>
