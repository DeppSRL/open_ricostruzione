{% extends "base.html" %}
{% load humanize %}
{% block title %}Donazioni{% endblock %}

{% block page-title %}Donazioni{% endblock %}
{% block stima-danno-number %}{{ stima_danno|onlynumber }}{% endblock %}
{% block stima-danno-word %}{{ stima_danno|onlyword }} {% if stima_danno > 1000000 %} di{% endif %}{% endblock %}
{% block tot-donazioni-number %}{{ tot_donazioni|onlynumber}}{% endblock %}
{% block tot-donazioni-word %}{{ tot_donazioni|onlyword }} {% if tot_donazioni > 1000000 %}  di{% endif %}{% endblock %}
{% block main-title %}<p style="color:#a1ba03; text-transform: uppercase;" >Donazioni</P>{% endblock %}
{% block breadcrumb %}{{ block.super }} &raquo; <a href="/donazioni/">Donazioni</a>{% endblock %}

{% block data-content %}


    <div class="row" style="margin-top:25px;">
        <div class="span12">
            <img src="../static/img/home_map.jpg" />
        </div>
    </div>

    <div class="row">
        <div class="span12">
            <div style="margin-top:25px;margin-bottom: 12px;">Andamento nel tempo delle donazioni</div>
            <div id="graph-container"></div>
        </div>
    </div>

    <div class="row">
        <div class="span6">
            {% if donazioni_categorie %}
                <div class="titolo donazioni"> Donazioni ricevute</div>
                <div class="subtitle">Ripartizione delle donazioni per soggetti</div>
                <div id="don_pie"></div>
                <div class="project_list">
                    {% for p in donazioni_categorie %}
                        <div class="project_row ">
                            <div class="box">
                                <div class="n_progetti">{{ p.c }} da {{ p.tipologia__denominazione }}</div>
                                <div class="importo">{{ p.sum|floatformat}} euro</div>
                            </div>
                            <div class="spacer"></div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="span6">
            {% if donazioni_last %}
                <div id="don_last">
                    <div class="titolo"> Ultime donazioni</div>
                    <div class="subtitle">Ultime donazioni per i Comuni del cratere</div>
                    <div class="project_list">
                        {% for p in donazioni_last %}
                            <div class="project_row ">
                                <div class="box">
                                    <div class="n_progetti">
                                        {{ p.data }} da {{ p.tipologia.denominazione }}
                                    </div>
                                    <div class="importo">{{ p.importo|floatformat}} euro</div>
                                </div>
                                <div class="spacer"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>


{% endblock %}


{% block graph-data %}
    <script>
        var chart1; // globally available
        var piechart;
        $(document).ready(function() {
            chart1 = new Highcharts.Chart({
            chart: {
            renderTo: 'graph-container',
                type: 'spline',
            plotBackgroundColor: '#fff'
            },
            title: {
                text: ''
            },
            tooltip: {
            formatter: function() {
            return '<b>'+ this.series.name +'</b><br/>'+
            this.x +': '+ this.y +' Euro';
            }
            },
            yAxis: {
                min:0,

                labels: {
                    formatter: function() {
                        return this.value;
                    }
                },
                title: {
                    text: 'Euro'
                }

            },
            xAxis: {
                type: 'datetime',
                labels:
                {
                    enabled: true
                },

                categories:[
                    {% for d in donazioni_spline %}
                        "{{ d.month }}",
                    {% endfor %}
                ]


            },
            series: [{
                name: 'Donazioni',
                data:[
                    {% for d in donazioni_spline %}
                        {{ d.sum }},
                    {% endfor %}
                ]
            } ]
            });

            /*PIE CHART*/
            piechart = new Highcharts.Chart({
                chart: {
                    renderTo: 'don_pie',
                    type: 'pie',
                    plotBackgroundColor: '#fff'

                },
                tooltip: {
                    formatter: function() {
                        return '<div class="tooltip-box"><b>'+ this.point.name +'</b>: '+ this.percentage.toFixed(2) +'<small>%</small></div>';
                    },
                    useHTML: true,
                    backgroundColor: '#F7F6F1',
                    borderWidth: 0,
                    shadow: false,
                    style: {
                        width: '150px',
                        'min-height': '20px'
                    }
                },
                title: {
                    text: 'Donazioni ricevute per tipologia'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false,
                            color: '#000000',
                            connectorColor: '#000000',
                            percentageDecimals: 2,
                            formatter: function() {
                                return '<b>'+ this.point.name +'</b>: '+ this.y +' Euro';
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Tipologia cedente',
                    title: 'Donazioni per tipologia',
                    data: [
                        {% for d in donazioni_categorie %}
                            ['{{ d.tipologia__denominazione }}',{{ d.sum }}],
                        {% endfor %}
                    ]
                }]



        });

    });
    </script>
{% endblock %}